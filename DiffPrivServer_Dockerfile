FROM python:2.7

# Copy needed files
COPY ./differential-privacy-master/differential_privacy /diffpriv/differential-privacy-master/differential_privacy
COPY ./differential-privacy-master/BUILD /diffpriv/differential-privacy-master
COPY ./differential-privacy-master/CONTRIBUTING.md /diffpriv/differential-privacy-master
COPY ./differential-privacy-master/differential_privacy_deps.bzl /diffpriv/differential-privacy-master
COPY ./differential-privacy-master/LICENSE /diffpriv/differential-privacy-master
COPY ./differential-privacy-master/README.md /diffpriv/differential-privacy-master
COPY ./differential-privacy-master/WORKSPACE /diffpriv/differential-privacy-master
COPY ./web /diffpriv/web
COPY ./bazel-1.0.1-installer-linux-x86_64.sh /diffpriv
COPY ./Const.py /diffpriv
COPY ./CSVHandler.py /diffpriv
COPY ./bazel-1.0.1-installer-linux-x86_64.sh /diffpriv
COPY ./bazel-1.0.1-installer-linux-x86_64.sh /diffpriv
COPY ./bazel-1.0.1-installer-linux-x86_64.sh /diffpriv
COPY ./bazel-1.0.1-installer-linux-x86_64.sh /diffpriv

# Change diretory
WORKDIR /diffpriv

RUN mkdir /diffpriv/csv_files/
RUN mkdir /diffpriv/logs/
RUN mkdir /diffpriv/users/
#RUN mkdir /diffpriv/web/

RUN apt-get update && apt-get upgrade -y
RUN apt-get install -y pkg-config zip g++ zlib1g-dev unzip python3 git flex bison libreadline-dev

# Install all python dependencies
RUN pip install -r requirements.txt

# Install bazel
RUN chmod +x bazel-1.0.1-installer-linux-x86_64.sh
RUN ./bazel-1.0.1-installer-linux-x86_64.sh --user
ENV PATH="$HOME/bin/:${PATH}"
#RUN cd differential-privacy-master/

WORKDIR /diffpriv/differential-privacy-master/

RUN /root/bin/bazel build differential_privacy/...

# Make port 5002 available to the world outside this container
EXPOSE 5002

WORKDIR /diffpriv

# Run DiffPrivServer.py when the container launches
#CMD ["python", "DiffPrivServer.py"]
#CMD ["bash"]
